# Github 'Push' webhook integration with Jenkins
## Purpose of using github webhook integration with jenkins
Most of the time, after a push on the upstream repository, one may want to check the result of all the checks on the repository defined by CI/CD pipeline. This tells whether there is some issue with push and whether or not the defined checks/tests have passed. This can be achieved using github push webhook integration with jenkins.
## Jenkins version and operating system specifications
The version of Jenkins and operating system specifications at the time of writing this documentation are mentioned below:  
**Jenkins version:** 2.370  
**Operating System:** Linux  
**Distribution:** Ubuntu  
**Release:** Focal (also called 20.04)

## Pre-requisites
- Jenkins
- ngrok (only if a public IP is not available)

## Setting up the ngrok
The localhost cannot be used for github webhook integration as it cannot be detected by online webservers. For this reason, a public ip must be used. For the sake of this documentation, ngrok is being used, which maps localhost to some public ip which can then be accessed publicly on the internet.  
  
Following steps can be used for setting up ngrok on ubuntu:
- Install ngrok.  
```
sudo apt install ngrok
```
- For using html content, a sign up is required on ngrok. So sign up on ngrok.
- Execute the following command to run ngrok which will provide a public ip mapped to localhost.  
```
ngrok http <port number>  
```  

This will setup ngrok and provide a public ip for working online.
## Setting up Jenkins for github webhook
### Pre-requisites
Following plugins should be installed in jenkins:
- Git Plugin
- GitHub API Plugin
- GitHub Plugin
### Jenkins Configuration in Settings
- Go to `Manage Jenkins > Configure System` and scroll down to `GitHub` section.  
- Click on `Add GitHub Server` 
    - Add a name for the Github server. 
    - Leave `API URL` as is. 
    - In Credentials, click on `Add`. `Jenkins` will appear in drop down, click on it. 
        - Select `Kind` as `Secret text`
        - Scroll down to the `Secret` and here, put down the github personal authentication token (PAT) which can be acquired from github account.
        - Other options can be left unattended.
        - Click on `Add`. Now the credentials should be added.
    - In the `Credentials` drop down, select `Secret text`.
    - Check `Manage hooks`.
    - Now the connection can be established and can be checked by clicking the `Test Connection`.
- Click `Save`.  
### Jenkins job setup for Github Webhook
Create a new jenkins freestyle job and proceed with following settings on the configurations along with desired settings.
- Check `GitHub project` in `General` section and provide GitHub repository URL.
- In `Source Code Management` section, select `Git`.
    - Give Repository URL
    - In `Credentials` (if the credentials are not created already), click on `Add`, click on `Jenkins` from the drop down.
        - Select `Kind` as `Username with password`. 
        - In `Username`, enter github username.
        - In `Password`, enter github personal authentication token (PAT) which can be acquired from github account.
        - Other fields can be left unattended.
        - Click on `Add`
    - From `Credentials` drop down, select your added credentials.
    - In `Branches to build` section, in `Branch Specifier` field, enter the name of branch of github repository which needs to be built.
- In `Build Triggers` section, check `GitHub hook trigger for GITScm polling`.  
 _(Following step is for checking the commit status according to the Jenkins job status, means if Jenkins job fails, commit status is also `Failure`)_  
- Scroll down to the bottom and `Add post-build action`. From drop down, select `Set GitHub commit status`.
    - Leave other settings as is and click on `Advanced`.
    - Check `Handle errors`
    - Under drop down `Result on failure`, select `FAILURE`
- Click on `Apply` and `Save`
- By this point, Jenkins is setup for github webhooks.

## Setting up github repository webhook
For the sake of this documentation, I have created a simple repository called `jenkins_hello_world_integrated`.
- Go to GitHub repository's settings  
  

![Screenshot from 2022-09-26 16-39-29](https://user-images.githubusercontent.com/99069972/192272619-657a40c5-ef9e-4a48-a2b0-17217ebcac70.png)  
  
- In `Webhooks` section, click on `Add webhook`  
  

![Screenshot from 2022-09-26 16-39-29](https://user-images.githubusercontent.com/99069972/192310841-ac0cdbd0-e515-445b-aca6-5875d5ff1583.png)  
  

- In Webhooks settings:
    - Add `Payload URL` as the URL of jenkins and append `/github-webhook/` at the end of it.
    - Select Content type `application/jason`.
    - It is recommended to add `Secret` which can be generated by jenkins `API Token` by going to account configuration.
    - It is recommended to `Enable SSL verification`.
    - Select the events which should trigger the build in jenkins.
    - Check `Active`.
    - Click on `Add Webhook`.  
      

    ![Screenshot from 2022-09-26 16-39-29](https://user-images.githubusercontent.com/99069972/192312918-03082be8-2c61-44a6-8165-dc24591db5ba.png)  
      
After this point each time the github repository is commited with a change, jenkins job will start the build and will also denote on the repository if the build has passed or failed (as can be seen in the below screenshot).
  
![Screenshot from 2022-09-26 16-39-29](https://user-images.githubusercontent.com/99069972/192314484-a761bb98-5fbe-4303-9627-d42ff1f096e1.png)  
  
<p align="center">
  <b>END OF DOCUMENTATION<b>
</p>
